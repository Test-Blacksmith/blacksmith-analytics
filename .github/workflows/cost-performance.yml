name: Cost-Performance Analysis

on:
  workflow_dispatch:

jobs:
  quick-task:
    name: "Quick Job (30s)"
    runs-on: blacksmith-4vcpu-ubuntu-2404
    steps:
      - name: Quick workload
        run: |
          START=$(date +%s)
          sleep 30
          END=$(date +%s)
          DURATION=$((END - START))
          
          echo "## âš¡ Quick Job Profile" >> $GITHUB_STEP_SUMMARY
          echo "- Duration: ${DURATION}s" >> $GITHUB_STEP_SUMMARY
          echo "- Overhead: ~30% of total" >> $GITHUB_STEP_SUMMARY

  medium-task:
    name: "Medium Job (5m)"
    runs-on: blacksmith-4vcpu-ubuntu-2404
    steps:
      - name: Medium workload
        run: |
          START=$(date +%s)
          for i in {1..10}; do
            sleep 30
          done
          END=$(date +%s)
          DURATION=$((END - START))
          
          echo "## âš™ï¸ Medium Job Profile" >> $GITHUB_STEP_SUMMARY
          echo "- Duration: ${DURATION}s" >> $GITHUB_STEP_SUMMARY
          echo "- Overhead: ~3% of total" >> $GITHUB_STEP_SUMMARY

  long-task:
    name: "Long Job (10m)"
    runs-on: blacksmith-4vcpu-ubuntu-2404
    steps:
      - name: Long workload
        run: |
          START=$(date +%s)
          for i in {1..20}; do
            sleep 30
          done
          END=$(date +%s)
          DURATION=$((END - START))
          
          echo "## ðŸ”„ Long Job Profile" >> $GITHUB_STEP_SUMMARY
          echo "- Duration: ${DURATION}s" >> $GITHUB_STEP_SUMMARY
          echo "- Overhead: ~1.5% of total" >> $GITHUB_STEP_SUMMARY

  analysis:
    name: "Cost Analysis"
    needs: [quick-task, medium-task, long-task]
    runs-on: blacksmith-4vcpu-ubuntu-2404
    if: always()
    steps:
      - name: Generate ROI analysis
        run: |
          echo "## ðŸ’° Cost-Performance Analysis" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Job Duration vs Cost Efficiency" >> $GITHUB_STEP_SUMMARY
          echo "| Duration | Overhead | Efficiency | Recommendation |" >> $GITHUB_STEP_SUMMARY
          echo "|----------|----------|------------|----------------|" >> $GITHUB_STEP_SUMMARY
          echo "| <1min | 30-40% | Poor | Batch tasks |" >> $GITHUB_STEP_SUMMARY
          echo "| 2-5min | 5-10% | Excellent | Ideal |" >> $GITHUB_STEP_SUMMARY
          echo "| 5-15min | 2-5% | Excellent | Ideal |" >> $GITHUB_STEP_SUMMARY
          echo "| >15min | 1-2% | Good | Consider split |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ROI Calculation" >> $GITHUB_STEP_SUMMARY
          echo "Reducing 15min build to 8min = 7min saved" >> $GITHUB_STEP_SUMMARY
          echo "- 20 builds/day Ã— 7min = 140min/day" >> $GITHUB_STEP_SUMMARY
          echo "- At 100 USD/hour = 233 USD/day saved" >> $GITHUB_STEP_SUMMARY
          echo "- Annual value = 60k USD per developer" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Key Insight" >> $GITHUB_STEP_SUMMARY
          echo "Predictable performance enables:" >> $GITHUB_STEP_SUMMARY
          echo "- Accurate SLA commitments" >> $GITHUB_STEP_SUMMARY
          echo "- Precise capacity planning" >> $GITHUB_STEP_SUMMARY
          echo "- No over-provisioning waste" >> $GITHUB_STEP_SUMMARY
